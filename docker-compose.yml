version: "3.3"

services:
  notifier:
    container_name: meditor_notifier
    build: notifier
    restart: on-failure
    depends_on:
      - database
    env_file:
      - .env

  ui:
    container_name: meditor_ui
    build: ui
    env_file:
      - .env
    ports:
      - "${UI_HOST_PORT}:4200"
    volumes:
      - ${UI_HOST_VOLUME}:/usr/src/app
      - /usr/src/app/node_modules
  
  server:
    container_name: meditor_server
    build: nodejs-server-server
    restart: always
    env_file:
      - .env
    ports:
      - "${SERVER_HOST_PORT}:8081"
    volumes:
      - ${SERVER_HOST_VOLUME}:/usr/src/app
      - /usr/src/app/node_modules
    links:
      - database
      - nats
    depends_on:
      - database
      - nats

  database:
    container_name: meditor_database
    image: dev.gesdisc.eosdis.nasa.gov:443/mongo/4.1.4
    volumes:
      - ${DATABASE_HOST_VOLUME}:/data/db
    command: mongod --port ${DATABASE_HOST_PORT}
    ports:
      - "${DATABASE_HOST_PORT}:${DATABASE_HOST_PORT}"

  database-seed:
    container_name: meditor_database_seed
    build: mongo-seed/.
    links:
      - database

  nats:
    container_name: nats
    image: nats-streaming:0.15.1 
    ports:
      - "${NATS_HOST_PORT}:4222"
      - "${NATS_MONITORING_PORT}:8222"
    volumes:
      - ${NATS_HOST_VOLUME}:/nats/data

